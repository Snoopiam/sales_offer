# Sales Offer Generator — Implementation Plan

**Based on:** Audit Report (2026-01-02)
**Current Score:** 74/100
**Target Score:** 85/100

---

## Summary

The main gap is test coverage. Tests exist and pass (93 tests) but don't exercise the actual source modules due to how imports are structured. Fixing test imports and adding coverage for core modules will significantly improve the health score.

---

## Recommended Actions

| Priority | Task | Relates To |
|----------|------|------------|
| 1 | Fix test imports to use actual source modules | Low test coverage |
| 2 | Add tests for calculator.js module | Low test coverage |
| 3 | Add tests for validator.js module | Low test coverage |
| 4 | Fix ESLint warnings in paymentPlan.js | ESLint warnings |
| 5 | Add tests for storage.js core functions | Low test coverage |
| 6 | Increase helpers.js coverage to 60%+ | Low test coverage |

---

## Phase 1: Immediate Fixes

**Fix ESLint Warnings**

Three warnings in `js/modules/paymentPlan.js`:

```javascript
// Line 272: Change let to const
const totalInitial = payments.reduce(...);

// Line 278: Prefix unused param with underscore
payments.forEach((payment, _index) => { ... });

// Line 336: Prefix unused param with underscore
exportCSV(_csv) { ... }
```

Run `npm run lint:fix` to auto-fix the `prefer-const` warning.

**Verify Test Setup**

Check that tests import actual source modules, not mocks. Current test files:
- `tests/calculator.test.js`
- `tests/validator.test.js`
- `tests/helpers.test.js`

Each should import from the actual source:
```javascript
import { calculateADGM } from '../js/modules/calculator.js';
import { validatePaymentPlan } from '../js/modules/validator.js';
import { formatCurrency } from '../js/utils/helpers.js';
```

---

## Phase 2: Improve Test Coverage

**Priority Modules for Testing**

1. **calculator.js** — Financial calculations (ADGM, fees, totals)
2. **validator.js** — Form and payment plan validation
3. **helpers.js** — Increase coverage from 26% to 60%+
4. **storage.js** — Core save/load functionality

**Test Structure Template**

```javascript
import { describe, it, expect, vi } from 'vitest';
import { functionName } from '../js/modules/module.js';

describe('ModuleName', () => {
  describe('functionName', () => {
    it('should handle normal input', () => {
      expect(functionName(input)).toBe(expected);
    });

    it('should handle edge cases', () => {
      expect(functionName(edgeCase)).toBe(expected);
    });
  });
});
```

---

## Phase 3: Optional Improvements

**Review Console Statements**

16 console statements exist. Most are appropriate for error handling. Consider:
- Keeping `console.error` for debugging production issues
- Replacing `console.warn` with user-visible notifications where appropriate
- Adding a logging utility if more control is needed

**Module Coverage Goals**

| Module | Current | Target |
|--------|---------|--------|
| helpers.js | 26% | 60% |
| calculator.js | 0% | 60% |
| validator.js | 0% | 60% |
| storage.js | 0% | 40% |
| Others | 0% | As needed |

---

## Expected Outcome

| Metric | Current | After Phase 1 | After Phase 2 |
|--------|---------|---------------|---------------|
| Health Score | 74 | 76 | 85+ |
| Test Coverage | 2% | 2% | 40%+ |
| ESLint Warnings | 3 | 0 | 0 |

---

*Plan generated by Claude (Auditor Skill)*
